##############################################################
## MOD Title: 		Premod phpBB3 SEO
## MOD Author: 		dcz / www.phpbb-seo.com
## MOD Description: 	Cette prémod est une version de phpBB complète et optimisée pour le référencement.
##			Veuillez lire les notes de l'auteur avent d'installer ce mod.
## 			Visitez http://www.phpbb-seo.com/forums/premod-phpbb-seo/premod-referencement-phpbb-vt1951.html
## 			pour obtenir du support et vérifier l'existence de mise à jour.
##
## MOD Version: 	3.0.2
##
## Installation Level: 	Aussi facile que phpBB3
## Installation Time: 	10 Minutes
## Files To Edit: 	0
##
##############################################################
## Author Notes:
## _____________
##
## Ceci est la Premod phpBB SEO. 
##
## ATTENTION : l'injection des titres des sujets dans leur URL peut s'avérer délicat à bien gérer. 
## Cela dépend du type de sujets traités sur votre forum.
## Dans pratiquement tous les cas, phpBB SEO recommande le mod Rewrite Intermédiaire (Mixed).
## Veuillez lire : http://forums.phpbb-seo.com/toolkit-phpbb-seo/mod-rewrites-phpbb-seo-vt65.html
##
## Cette Premod est et sera compatible avec tous les mods phpBB SEO, des instructions supplémentaires pouvant intervenir pour l'installation.
## phpBB SEO fournira les solutions nécessaires pour prendre en charge d'autres formats d'URLs, 
## pour que tous puissent tirer parti des avancées des mods Rewrite phpBB SEO sans pour autant risquer de perdre leurs acquis
## en référencement et PageRank.
##
## 
## Char-sets :
## ___________
##
## 	phpBB3 utilise l'UTF-8 comme encodage final, ce qui devrait être suffisant pour tous les types d'alphabets.
## L'UTF-8 est totalement pris en charge par ce mod.
##
## Ce mod rewrite injectera uniquement les caractères ASCII, débarrassés de leurs accents, présents dans les titres.
## 
## Par exemple : "[caractères non ASCII] Software niño" sera formaté de cette façon : "software-nino".
##
##
## Migration :
## ___________
##
## Si vous effectuez une migration, c'est-à-dire que votre forum est déjà référencé avec d'anciennes URLs,
## vous devrez utiliser un autre fichier robots.txt, et installer le zéro dupe.
## Les anciennes URLs seront redirigées (avec en-tête HTTP 301) vers les nouvelles.
## La procédure vous permettant de migrer tout en conservant vos pages indexées est simple, mais doit s'effectuer au cas par cas.
## Rendez-vous sur le forum Premod phpBB SEO ( http://www.phpbb-seo.com/forums/premod-phpbb-seo-vf64/ ).
## 
##
## LICENSE:
## ________
##
## phpBB est diffusé sous la licence GPL General Public License v2 ( http://opensource.org/licenses/gpl-license.php ) 
## La premod inclus les mods Rewrite phpBB SEO et le zéro duplicate diffusés sous la licence RPL ( http://www.opensource.org/licenses/rpl.php )
## qui indique que vous ne pouvez pas retirer les crédits phpBB SEO, et que vos améliorations et changements doivent être soumis
## à l'équipe de phpBB SEO avant d'être éventuellement ajoutés au package. 
##
## Bien entendu, l'utilisation selon les présents critères de ce mod est totalement libre, gratuite et sans autres limitations.
##
## Pour plus de détails concernant les exceptions possibles, merci de contacter un administrateur de phpBB SEO (Prioritairement SeO ou dcz).
##
## Tout manquement à ces règles contribuera à mettre le support et le développement sur www.phpbb-seo.com en péril.
##
##############################################################
## MOD History:
##
##	2008-07-14 - 3.0.2
##		- Updated to comply with phpBB 3.0.2.
##		- Added GYM sitemaps & RSS 2.0.B2
##		- mod rewrite 0.4.4 :
##			- Fixed the update bug caused by the empty phpbb_seo class,
##			- Fixed pagination rewriterules for forum url without id and with a suffixe different that "/",
##			- Fixed install script for no MYSQL DB,
##			- Fixed search for word startting / ending with a,m or p,
##			- Fixed various virtual root wrong links,
##			- Various optimization in phpbb_seo_class.php
##		- zero duplicate 0.4.4 :
##			- Fixed : view=next/previous links, 
##			- Fixed : post redirecting when post is not on first page, 
##		- Meta tags 0.2.4 :
##			- Fixed common words filtering in viewtopic,
##			- Added noindex tag based on GET vars to exclude many annoying URLs
##	2008-04-12 - 3.0.1
##		- Updated to comply with phpBB 3.0.1.
##		- mod rewrite 0.4.2 :
##			- Updated : User messages pages URLs structure,
##			- Added : virtual folder option for user messages pages,
##			- Added : copyright link formatting options,
##			- Added : support for active_topics link,
##			- Added : support for unanswered link,
##			- Added : support for newposts link,
##			- Added : support for egosearch link,
##			- Added : support for most active topic link on profile view,
##			- Fixed : group sort option links,
##			- Fixed : unread link it topic view,
##			- Fixed : Session tracking : Sessions tracking is now fully fixed for viewforum, 
##			  but will only work with virtual folder trick in viewtopic,
##			- Various optimizations in phpbb_seo_class.php and acp_phpbb_seo.php.
##		- zero duplicate 0.4.2 :
##			- Added : support for new URL rewritten pages,
##			- Added : FF default iso encoding workaround, 
##			- Fixed : ignored posts, 
##			- Fixed : highlights, 
##			- Fixed : jumpto post link in emails,
##			- Fixed : style preview,
##			- Fixed : viewpoll topic links.
##		- no duplicate 0.4.2 :
##			- Fixed : moved topic links on forum indexes.
##		- Optimal titles 1.0.2 :
##			- Updated : Minor additions.
##		- Meta tags 0.2.2 :
##			- Added : now filter code bbcode tag by default,
##			- Fixed : reference misuse,
##			- Fixed : use of sql_query_limit to grab keywords in topic view.
##	2007-12-21 - 3.0.0
##		- Added : Link to the last topic title above the last post link on forum listing view,
##		- Added : Group URL rewriting, with optional group name injection,
##		- Added : profile URL can use nickname injection (optional),
##		- Added : profile URL can use nickname injection without ID (optional),
##		- Added : User messages URL can use nickname injection (optional),
##		- Added : User messages URL can use nickname injection without ID (optional),
##		- Added : 404 header is now returned for forums that do not exist (both rewritten and vanilla URLs),
##		- Updated : zero duplicate handles the new rewriting for profiles, user messages and groups,
##		- Fixed : Sub forum last post link from the no duplicate on forum listing view,
##		- Fixed : Usage of a slash as a suffix is now fully supported for all rewritten URLs,
##		- Fixed : Base href handling (bug with virtual root option),
##		- Fixed : 100% XHTML valid output,
##		- Updated to comply with phpBB3.0.0.
##	2007-10-16 - 3.0.RC7
##		- Updated the mod rewrites,
##		- Updated to phpbb3.0.RC7.
##	2007-09-20 - 3.0.RC5a
##		- Fixed typos in the language file,
##		- Enhanced the premod sud-version checking.
##	2007-09-11 - 3.0.RC5
##		- First public Version, versioned following the phpBB version
##
##
##############################################################
## Before Adding This MOD To Your Forum, You Should Back Up All Files Related To This MOD
##############################################################


#
#-----[ DIY INSTRUCTIONS ]--------------------------------------------------
#

Le pack de langue FR mis à jour n'est malheureusement pas disponible à ce jour, il sera inclus à cette archive dès mise à disposition.

_____________________________________________
>>>>   MISE A JOUR	                <<<<<
_____________________________________________

Mise à jour : 3.0.1 => 3.0.2 : 
Tout d'abord, rendez vous sur http://telecharger.phpbb-seo.com/premod-referencement-phpbb-10/
poour télécharger un des pack de mise à jour.
Vous pouvez mettre à jour en suivant deux méthodes :
	1) Mise à jour automatique : "3.0.1 vers 3.0.2 MAJ automatique"
		- Uplodez le contenu du dossier auto_update/install/*.* vers install/*.*,
		- Rendez vous à l'ACP => SYSTEM et suivez les instructions.
		L'auto updateur prendra vos éventuelles modifications en compte et tentera
		de merger les nouveaux fichiers avec ceux que vous auriez modifié.
		C'est la methode la plus sûre dans la plupart des cas, l'updateur vous dira
		s'il a des problème pour modifier certain fichiers.
	2) Mise à jour manuelle : "3.0.1 vers 3.0.2 Fichiers modifiés"
		Vous trouverez les fichiers modifiés dans le dossier modified/ de l'archive.
		- Uploadez / mergez / écrasez tous les fichiers,
		- Uploadez le dossier modified/install/*.* vers install/*.*,
		- Lancez www.example.com/phpbb/install/database_update.php pour mettre à jour la base de données.

Si vous rencontrez des difficultés lors de la mise à jour du fichier phpbb_seo_class.php, vous devrez procéder 
manuellement. Il vous suffit pour cela de prendre la nouvelle version du fichier et d'y ajouter vos éventuels 
réglages personnalisés comme s'il s'agissait d'une première installation.

Enfin, une fois les nouveaux fichiers en place, il vous faudra vider le cache de phpBB et rafraîchir vos thèmes 
(ACP => STYLE => Thèmes => Rafraîchir).

Nous avons inclus le mod GYM Sitemap & RSS, mais comme il est encore en phase bêta, nous avons séparé l'installation
reportez vous aux instructions plus bas pour plus de détails.

_____________________________________________
>>>>   INSTALLATION POUR VOTRE FORUM    <<<<<
_____________________________________________

___________
IMPORTANT :
______________________________________________________
Avant de commencer, lisez attentivement ce qui suit.
=> Pour une installation en douceur :
	1) Uploadez tous les fichiers et rendez vous sur www.votresite.com/phpBB/;
	2) Suivez les instruction d'installation / conversion / mise à jour;
	3) Rendez vous dans l'ACP de phpBB : C'est le moment de faire des réglages, décrits ci dessous;
	4) Générez votre .htaccess et uploadez le en suivant les instructions de l'interface;
	5) Testez une URL réécrite, comme www.votresite.com/phpBB/post1.html, si vous obtenez une 404 (pas un message de phpBB), revenez à l'étape précédente;
	6) Activez la réécriture d'URL et accordez vous une pointe d'autosatisfaction :D
	7) Activez le zero duplicate est une bonne chose à ce stade.
______________________________________________________

___________
 Réglages :
___________

Les réglages doivent être fait avant l'étape numéro 4 ci dessus,
des modification tardives entraîneront probablement des changement dans le .htaccess, 
et pourront nécessiter des redirections personnalisées.

=> Par défaut, ce mod va retirer index.php de l'URL de l'index de phpBB.
Vous pouvez changer cela dans phpbb_seo/phpbb_seo_class.php.
Trouver :

'index' => ''

dans cette ligne de code :

		$this->seo_static = array( 'forum' => 'forum', 'topic' => 'topic', 'post' => 'post', 'user' => 'member', 'group' => 'group', 'index' => '', 'global_announce' => 'announces', 'leaders' => 'the-team', 'atopic' => 'active-topics', 'utopic' => 'unanswered', 'npost' => 'newposts', 'pagination' => 'page', 'gz_ext' => '.gz' );

Remplacer par :

'index' => 'forum'

Ou par ce que vous voulez.
C'est surtout pratique dans le cas ou vous utiliseriez un portail dans le même dossier que phpBB.

=> Les premiers réglages à faire sont le choix des parties statiques de vos URL, dont index.html fait parti.
Vous pouvez modifier dans phpbb_seo/phpbb_seo_class.php :
	=> equipe.html
		$this->seo_static['leaders'] = 'equipe';

	=> annonces
		$this->seo_static['global_announce'] = 'annonces';

	=> Sujets actifs :
		$this->seo_static['atopic'] = 'sujets-actifs';

	=> Unaswered :
		$this->seo_static['utopic'] = 'sans-reponses';

	=> Newposts :
		$this->seo_static['npost'] = 'nouveaux-messages';

	=> Ainsi que forum ('forum' => 'forum'), topic ('topic' => 'topic'), post ('post' => 'post'), 
	membre ($this->seo_static['user'] = 'membre';), groupes ($this->seo_static['group'] = 'groupe';)
	et le terme statique de la pagination avec dossiers virtuels ('pagination' => 'page')

	=> et les extentions, si .html ne vous conviens pas :
		$this->seo_ext = array( 'forum' => '.html', 'topic' => '.html', 'post' => '.html', 'user' => '.html', 'group' => '.html',  'index' => '', 'global_announce' => '/', 'leaders' => '.html', 'atopic' => '.html', 'utopic' => '.html', 'npost' => '.html', 'pagination' => '.html', 'gz_ext' => '');

Ces changements seront pris en compte lors de la génération du .htaccess.

=> Les autres options sont accessible sur une page de réglage, stade 7) de l'installation.
Rendez vous tout d'abords sur la page "Réglages de la classe phpBB SEO", et faites les réglages qui vous conviennent.

=> C'est le moment de jouer avec les URLs de vos forums.
Pour cela, rendez vous sur la page "Gestion des URL des Forums", et commencez à choisir 
de bon mots clés pour les URLs de vos forums.
Prenez votre temps pour ce faire, et n'oubliez pas que d'utiliser l'option 
"Retirer les IDs de forum" rendra les redirections un peu plus compliquées si vous modifiez
des URLs de forum après avoir commencer à les utiliser.
Si vous créez de nouveaux forums par la suite, vous devrez simplement vous rendre de nouveaux 
sur la page "Gestion des URL des Forums" pour personnaliser l'url de votre forum.
Si non, l'url ne sera pas en cache, et celle par défaut sera utilisée pour ce forum (titre-forum-fxx).

___________
NOTE: Cache
___________
Les fichiers cachés se trouve dans le dossier phpbb_seo_/cache/.
phpbb_cache.php est le fichier contenant vos réglages ainsi que les URL personalisés de vos forums.

Le mod crée toujours un backup du fichier cache en cours : 
	=> phpbb_cache.php.current est une copie de phpbb_cache.php.
	Elle sera utilisée automatiquement si jamais phpbb_cache.php venait à être effacé ou corrompu (ce qui e devrait pas arriver, mais ...).
	=> phpbb_cache.php.old est une copie de vos précédent régalges, avant la dernière modification que vous avez faite.

Vous devriez sauvegarder ces fichiers après les avoir modifier, ils sont aussi important que
votre base de donnée pour vos forums, vu qu'il sont requis pour le fonctionnement de leur URLs.
Rassurez vous, ce n'est qu'une précaution standard, vous ne devriez pas avoir de soucis avec ces fichiers,
mais jamais, c'est mieux, d'où la sauvegarde.

____________
 .htaccess :
____________

Dans le module d'administration phpBB SEO, rendez vous sur la page "htaccess".
Un .htaccess adapté à vos réglages y sera affiché. C'est le premier .htaccess à essayer.
Si la suggestion par défaut ne fonctionne pas, vous pourrez afficher des options supplémentaires, et générer plusieurs variantes.
Vous trouverez un fichier .htaccess vide dans le dossier contrib/ de l'archive du mod. 
Vous pouvez l'utilisez pour y copier le contenu du .htaccess généré par la page de réglage ou l'enregistré directement sur le serveur.

Veuillez vous rendre sur : http://forums.phpbb-seo.com/principes-du-referencement/forcer-www-dans-un-domaine-vt31.html
pour voir comment forcer l'utilisation ou l'absence du préfixe www dans l'URL de votre domaine.
C'est une chose importante à faire pour une bonne optimisation de votre référencement.

____________
robots.txt :
____________

Vous trouverez un exemple de robots.txt dans le dossier contrib/ de ce package.
Le robots.txt doit être placé à la racine de votre domaine (qui peut être différent du dossier de phpBB).
Il faut bien entendu remplacer dossierphpbb/ par votre vrai dossier d'installation (ou par rien pour une installation à la racine du domaine).

IMPORTANT :
	Si vous installez cette premod à partir d'un forum phpBB préalablement indexé avec des urls non réécrites, 
	vous devrez attendre deux mois après l'activation du zéro duplicate avant de mettre le robots.txt en place. 
	Dans ce cas, nous voulons rediriger avant d'interdire.

_____________________________________________________
NOTE: URL de profil et de messages de membre sans ID:
_____________________________________________________

phpBB/member/pseudo VS  phpBB/pseudo-uxx.html

Si vous utilisez les URL de profil et de messages de membre sans ID, vous devez noter que de l'urlencodage 
va entrer en jeux pour prevenir un bug de mod_rewrite. 
Ceci impleque que certains cas particuliers, comme "&", "/", "#" et les espaces seront doublement encodés dans un pseudo.
Par exemple, un membre dont le pseudo serait rock&roll devrait être doublement urlencodé pour être utilisable : rock%2526roll
( http://www.php.net/urlencode => http://issues.apache.org/bugzilla/show_bug.cgi?id=34602 )

Il y a d'autre cas ou des caractères seront urlencodés, comme les accents.
Ce n'est pas vraiment un problème pour les bots, ils comprennent l'urlencodage, mais cela peu finir 
par faire d'assez longues URLs avec des caractères multy byte.
Cela ne concerne pas les caractères a-zA-Z0-9 chars, underscore ("_"), tiret ("-") et point (".") inclus.

Dans phpbb_seo/phpbb_seo_class.php, un seul encodage est désormais disponible.

Cela veut bien entendu dire que les URL de profil et de messages de membre sans ID est bien plus adapté 
a des pseudo utilisant des caractères alphanumériques (sans accents). 

Si vous autorisez uniquement les caractères alphanumériques dans les pseudo de vos membres, vous pouvez accélérer 
le processus de retrait des ID en ajoutant : 

	return $url;

juste après :

	function seo_url_encode( $url, $type = 1 ) {

Enfin, n'oubliez pas que vous pouvez obtenir de très bon résultats avec les ID et que vous pouvez toujours simuler des dossier dans ces urls.

__________________________
NOTE: GYM Sitemaps & RSS :
__________________________

Le module GYM Sitemaps & RSS est désormais inclus dans la premod.
Solution modulaire pour générer des plans Sitemaps Google et des flux RSS 2.0 pour phpBB
Ce mod va créer un SitemapIndex Google établissant la liste des Sitemaps Google installés.
Il génère également des flux RSS 2.0.
Utilise un système de cache supportant pleinement la compression GZip,
ainsi que de la mise en forme XSLTransform pour les plans de site Google et les flux RSS.
Visitez http://www.phpbb-seo.com/forums/gym-sitemaps-rss/sitemaps-rss-google-yahoo-msn-vt3136.html
pour obtenir du support et vérifier l'existence de mise à jour.

NOTA BENE : 

	GYM Sitemaps & RSS est en phase bêta, l'installation est donc séparée de celle de la premod.
	C'est a vous de décider de l'utiliser ou non, vous devez juste savoir qu'à ce stade, certaines
	fonctions peuvent ne pas être disponibles et que quelques bugs peuvent encore être découverts.


POUR INSTALLER LE MODULE :

Si phpBB est installé dans un sous-dossier, et que vous avez d'autres pages à la racine, 
vous pouvez utiliser la modularité du système GYM pour ajouter tous vos plans de sites Google dans le même index.

Pour ce faire, vous devrez déplacer le fichier sitemap.php à la racine de votre domaine, l'éditer et remplacer :

	$phpbb_root_path = './';

Par : 

	$phpbb_root_path = './phpbb/';


En remplaçant, bien entendu, 'phpbb' par le nom du dossier dans lequel phpBB est installé sur votre système.

Vous devrez ensuite vous rendre dans le panneau d'administration et mettre à jour l'option "URL du Sitemap Google" de la catégorie 
"Sitemaps Google", onglet "Paramètres des Sitemaps Google". Il faut utiliser l'URL complète du domaine au lieu 
de celle du forum : http://www.example.com/ au lieu de http://www.example.com/phpbb/
Les liens vers le forum resteront bien entendu valides.

Notez que la même opération est également possible pour le fichier gymrss.php et qu'il peut être pratique 
de les mettre tous au même endroit.

___________
Nota Bene :
___________

Si vous avez installé phpBB dans un sous dossier (example.com/phpbb/) et le fichier sitemap.php (et/ou gymrss.php) 
à la racine du domaine (example.com/sitemap.php) en suivant les instructions ci-dessus, vous devrez adapter 
les chemins dans les rewriterules liés à sitemap.php (et/ou gymrss.php) en conséquence.
Et si le .htaccess de phpBB se trouvait dans le sous dossier (/phpbb), le déplacer dans le .htaccess de la racine du domaine.


===> Pour installer <===

	=> Connectez vous en admin sur votre forum et lancez le script gym_install.php pour finir l'installation
	   (Appelez l'URL http://www.votredomaine.com/dossier_phpbb/gym_sitemaps/gym_install.php)
	
NOTE :
Les requêtes d'installation ont été validés sur toutes les versions de mysql supportées par phpBB3,
mais malheureusement pas sur les autres bases de données (oracle, sqlite, postgresql, etc.).
Il y a cependant un certain espoir qu'elles fonctionnent sans autre modification !!!!!

GYM Sitemaps & RSS devrait pour le reste fonctionner avec toutes les bases de données supportées par phpBB3.

======> La seule URL à soumettre pour vos Sitemaps est http://www.votredomaine.com/dossier_phpbb/sitemap.php
======> ou http://www.votredomaine.com/dossier_phpbb/sitemapindex.xml avec réécriture d'URL activée.
======> Vous devez vous assurer que l'URL est valide et fonctionnelle avant de la soumettre,
======> il suffit d'appeler l'URL en question dans votre navigateur et de regarder le bon déroulement du MOD.



Pour désinstaller :

	1) Connectez vous en admin sur votre forum et lancez le script gym_install.php pour lancer la désinstallation
	   (Appelez l'URL http://www.votredomaine.com/dossier_phpbb/gym_sitemaps/gym_install.php)
	   
	2) Effacez tous les fichier ajoutés et les quelques ajouts de code du module dans les fichiers de phpBB.

________________
NOTE : .htaccess
________________

Si GYM Sitemaps & RSS est installé sur votre forum, le générateur de .htaccess générera automatiquement
les RewriteRules nécessaires pour GYM sitemaps & RSS. Vous devrez alors simplement générer un nouveau .htaccess et le mettre en place.

#
#-----[ COPY ]--------------------------------------------------
#

copy root/*.* to root/*.*

#
#-----[ SAVE/CLOSE ALL FILES ]------------------------------------------
#
# EoM
