##############################################################
## MOD Title: 		phpBB3 SEO Premod
## MOD Author: 		dcz / www.phpbb-seo.com
## MOD Description: 	This Package is a fully SEOed phpBB3 Premod
## 			Check http://www.phpbb-seo.com/boards/phpbb-seo-premod/seo-url-premod-vt1549.html
## 			for the latest version or to get help.
##
## MOD Version: 	3.0.4
##
## Installation Level: 	As easy as phpBB3
## Installation Time: 	10 Minutes
## Files To Edit: 	0
##
##############################################################
## Author Notes:
## _____________
##
## This is the phpBB SEO Premod. 
##
## WARNING : Topic title injection in URL can be hard to deal with depending on the type of subjects your
## forum is about. In most cases phpBB SEO recommend the use of the phpBB SEO mixed mod Rewrite instead.
## Please read : http://boards.phpbb-seo.com/phpbb-seo-toolkit/phpbb-seo-mod-rewrites-vt66.html
##
## This Premod is and will be compatible to all phpBB SEO modules, specific install instructions may apply.
## phpBB SEO will provide patches to allow for other URL standards support upon request, 
## so that everyone can take advantage of the phpBB mod Rewrites enhancement without jeopardising his Page-Ranking.
##
##
## Char-sets :
## ___________
##
## 	phpBB3 uses UTF-8 as final encoding, and this should be enough to handle all cases. 
## UTF-8 is fully supported by this mod.
## The mod rewrite will only inject the ASCII Chars ( after removing all accents ) available in the titles.
## 
## For example : "[non ASCII chars] Software niño" will be formated this way prior to injection : "software-nino".
## It is still possible that some characters only having a decimal HTML/XML entity won't be handled properly at first.
## The method to filter these is simple, please ask for help in our forums.
##
## Migration :
## ___________
##
## If you are migration, eg if your forum is already indexed using different URLs, 
## you'll have to use another robots.txt and install the zero duplicate. 
## The migrating procedure will allow you to migrate and keep your previously indexed pages.
## Older links will be HTTP 301 redirected to the new ones. It is rather simple, but the solution depends on cases. 
## Let's meet in the Premod forum ( http://www.phpbb-seo.com/boards/phpbb-seo-premod-vf61/ ).
## 
##
## LICENSE:
## ________
##
## phpBB is released under the GPL General Public License v2 ( http://opensource.org/licenses/gpl-license.php ) 
## The Premod includes the phpBB SEO mod Rewrites and the zero duplicate which are released under the 
## RPL Licence ( http://www.opensource.org/licenses/rpl.php ) 
## which states you cannot remove the phpBB SEO credits and if you make any modifications you have to resubmit them
## to phpBB SEO for inclusion into this package again. You can read the license for yourself for further info.
##
## You can of course use this mod without any more limitations than those stated here and in the licence.
##
## For more details about possible exceptions, please contact a phpBB SEO administrator (primarily SeO or dcz).
##
## Failure to comply will jeopardize support and developments.
##
##############################################################
## MOD History:
##
##	2008-12-20 - 3.0.4
##		- All mods Updated to comply with phpBB 3.0.4.
##		- GYM Sitemaps & RSS 2.0.RC3 :
##			- Added more option for displaying links on the forum,
##			- Fixed Google ping again,
##			- Various bug fixes and enhancement.
##		- mod rewrite 0.4.8 :
##			- Added : topic and forum url are now rewritten in notification emails,
##			- Added : topic url in print view is now rewritten.
##		- zero duplicate 0.4.8 :
##			- Fixed : ' character in highlights, 
##			- Fixed : No redirecting when marking / bookmarking / subscribing.
##	2008-11-20 - 3.0.3
##		- All mods Updated to comply with phpBB 3.0.3.
##		- Re-enabled search_ignore_words.php for Fulltext Native indexing :
##		  http://www.phpbb-seo.com/boards/phpbb3-seo-toolkit/meta-keyword-optimization-vt3472.html
##		- GYM Sitemaps & RSS 2.0.RC1 :
##			- Added html sitemaps and news pages,
##			- Added dynamic linking to sitemaps, feeds, maps and news on the forum,
##			- Fixed Google and Yahoo pinging (RSS & Google),
##			- Improved bbcode handling and generally, message filtering,
##			- Many minor bug fixes and enhancements.
##		- mod rewrite 0.4.6 :
##			- Complete rewrite of the phpbb_seo::url_rewrite method,
##			  the phpbb_seo class is now path aware.
##			- Fixed : global annoucement display when the lowest forum id is not public,
##			- Fixed : possibly wrong forum id in active topic last posts links,
##			- Many minor bug fixes and enhancements in phpbb_seo_class.php.
##		- zero duplicate 0.4.6 :
##			- Fixed : Viewpoll result redirect, 
##			- Added support for the new hash _GET var.
##		- no duplicate 0.4.6 :
##			- Fixed : possibly wrong forum id in active topic last posts links.
##		- Meta tags 0.2.6 :
##			- Enabled search_ignore_words.php filtering (optional),
##			- Added few yet useful options in the meta class.
##		- Optimal titles 1.0.4 :
##			- Fixed tiny glitch in overall_header.html.
##	2008-07-14 - 3.0.2
##		- Updated to comply with phpBB 3.0.2.
##		- Added GYM sitemaps & RSS 2.0.B2
##		- mod rewrite 0.4.4 :
##			- Fixed the update bug caused by the empty phpbb_seo class,
##			- Fixed pagination rewriterules for forum url without id and with a suffixe different that "/",
##			- Fixed install script for non MYSQL DB,
##			- Fixed search for word startting / ending with a,m or p,
##			- Fixed various virtual root wrong links,
##			- Various optimization in phpbb_seo_class.php
##		- zero duplicate 0.4.4 :
##			- Fixed : view=next/previous links, 
##			- Fixed : post redirecting when post is not on first page, 
##		- Meta tags 0.2.4 :
##			- Fixed common words filtering in viewtopic,
##			- Added noindex tag based on GET vars to exclude many annoying URLs
##	2008-04-12 - 3.0.1
##		- Updated to comply with phpBB 3.0.1.
##		- mod rewrite 0.4.2 :
##			- Updated : User messages pages URLs structure,
##			- Added : virtual folder option for user messages pages,
##			- Added : copyright link formatting options,
##			- Added : support for active_topics link,
##			- Added : support for unanswered link,
##			- Added : support for newposts link,
##			- Added : support for egosearch link,
##			- Added : support for most active topic link on profile view,
##			- Fixed : group sort option links,
##			- Fixed : unread link it topic view,
##			- Fixed : Session tracking : Sessions tracking is now fully fixed for viewforum, 
##			  but will only work with virtual folder trick in viewtopic,
##			- Various optimizations in phpbb_seo_class.php and acp_phpbb_seo.php.
##		- zero duplicate 0.4.2 :
##			- Added : support for new URL rewritten pages,
##			- Added : FF default iso encoding workaround, 
##			- Fixed : ignored posts, 
##			- Fixed : highlights, 
##			- Fixed : jumpto post link in emails,
##			- Fixed : style preview,
##			- Fixed : viewpoll topic links.
##		- no duplicate 0.4.2 :
##			- Fixed : moved topic links on forum indexes.
##		- Optimal titles 1.0.2 :
##			- Updated : Minor additions.
##		- Meta tags 0.2.2 :
##			- Added : now filter code bbcode tag by default,
##			- Fixed : reference misuse,
##			- Fixed : use of sql_query_limit to grab keywords in topic view.
##	2007-12-21 - 3.0.0
##		- Added : Link to the last topic title above the last post link on forum listing view,
##		- Added : Group URL rewriting, with optional group name injection,
##		- Added : profile URL can use nickname injection (optional),
##		- Added : profile URL can use nickname injection without ID (optional),
##		- Added : User messages URL can use nickname injection (optional),
##		- Added : User messages URL can use nickname injection without ID (optional),
##		- Added : 404 header is now returned for forums that do not exist (both rewritten and vanilla URLs),
##		- Updated : zero duplicate handles the new rewriting for profiles, user messages and groups,
##		- Fixed : Sub forum last post link from the no duplicate on forum listing view,
##		- Fixed : Usage of a slash as a suffix is now fully supported for all rewritten URLs,
##		- Fixed : Base href handling (bug with virtual root option),
##		- Fixed : 100% XHTML valid output,
##		- Updated to comply with phpBB3.0.0.
##	2007-10-16 - 3.0.RC7
##		- Updated the mod rewrites,
##		- Updated to phpbb3.0.RC7.
##	2007-09-20 - 3.0.RC5a
##		- Fixed typos in the language file,
##		- Enhanced the premod sud-version checking.
##	2007-09-11 - 3.0.RC5
##		- First public Version, versioned following the phpBB version
##
##
##############################################################
## Before Adding This MOD To Your Forum, You Should Back Up All Files Related To This MOD
##############################################################


#
#-----[ DIY INSTRUCTIONS ]--------------------------------------------------
#

________________________________________
>>>>   UPDATE INSTRUCTION   	   <<<<<
________________________________________

Update 3.0.3 => 3.0.4 :
First, go to http://downloads.phpbb-seo.com/seo-url-premod-12/
where you'll be able to download the update packages
You can update using two method :
	1) Auto updating : "3.0.3 to 3.0.4 Auto update"
		- Upload the auto_update/install/*.* folder of the update package to install/*.*
		- Go to ACP => SYSTEM and follow instructions.
		The auto update method will take the eventual code change you have made into account, 
		and will attempt to merge the new files with your online modified ones.
		It's the safest method for most, the installer will tel you if it has trouble to update some files.
	2) Manual updating : "3.0.3 to 3.0.4 Changed Files"
		You'll find the modified file list in the modified/ folder of the update package.
		- Upload / merge / overwrite all file,
		- Upload the modified/install/*.* to install/*.*,
		- Run www.example.com/phpbb/install/database_update.php to update the DB.

If you encounter some difficulties to update the phpbb_seo_class.php file, for example if you modded it, 
you will just have to use the new file and edit it to re enter your previous customisations (static part & delimiters).

Once you will have updated, you will have to refresh your theme's cache as well as phpBB's cache 
(ACP => STYLE, Themes => Refresh).

We have included the mod GYM Sitemap & RSS, but we kept the install separated
see bellow to install.

To update GYM from all 2.0.x (phpBB3) versions you will have to upload all files in the root/ directory of the archive to your phpBB/ ftp directory, after you will have taken care manually of the eventual code change you would have implemented in the template files (directory phpBB/styles/, .html, .js and .xsl) added by the module.
Once done, just lunch the update script (example.com/phpBB/gym_sitemaps/gym_install.php).
Your settings will be kept during the update porcess.

IMPORTANT :
GYM sitemaps and RSS is likely to be updated before the premod, it will be up to you to
keep it up to date meanwhile, you can be notified about updates by subscribing to the release thread while logged in :
http://www.phpbb-seo.com/boards/viewtopic.php?t=2734&watch=topic

________________________________________
>>>>   INSTALLATION INSTRUCTION    <<<<<
________________________________________
___________
IMPORTANT :
________________________________________
Before you start, read this with caution.
=> For a smooth install :
	1) Upload all files and lunch www.yoursite.com/phpBB/ in your browser;
	2) Follow the installation / conversion / upgrade steps;
	3) Go to phpBB ACP : It's now time to play with settings described bellow;
	4) Generate your personalized .htaccess and upload or move it following the instructions;
	5) Test a rewritten URL, such as www.yoursite.com/phpBB/post1.html, if you end up with a 404 (not a phpBB message), go back to step 5;
	6) Activate URL rewriting in phpBB ACP and allow yourself some auto-congratulation :D
	7) Activate the Zero duplicate is wise at this point.
________________________________________

__________
Settings :
__________

The settings must be done before step 4 above for the generated .htaccess to be up to date.
Later modification will most likey require a new .htaccess as well as personalized redirections.


=> By Default, this mod will get rid of index.php for phpBB's index.
You can change this in phpbb_seo/phpbb_seo_class.php if you prefer.
Look for :

'index' => ''

In this line of code :

		$this->seo_static = array( 'forum' => 'forum', 'topic' => 'topic', 'post' => 'post', 'user' => 'member', 'group' => 'group', 'index' => '', 'global_announce' => 'announces', 'leaders' => 'the-team', 'atopic' => 'active-topics', 'utopic' => 'unanswered', 'npost' => 'newposts', 'pagination' => 'page', 'gz_ext' => '.gz' );


And replace with  :

'index' => 'forum'

or whatever you may prefer.
This is mostly useful if you're running a portal in the folder where phpBB is installed. 

=> The first setting to do is to select which static part to use in your URLs. 

To do so, you can modify this line in phpbb_seo/phpbb_seo_class.php :

		$this->seo_static = array( 'forum' => 'forum', 'topic' => 'topic', 'post' => 'post', 'user' => 'member', 'group' => 'group', 'index' => '', 'global_announce' => 'announces', 'leaders' => 'the-team', 'atopic' => 'active-topics', 'utopic' => 'unanswered', 'npost' => 'newposts', 'pagination' => 'page', 'gz_ext' => '.gz' );

	=> the-team :	
		'leaders' => 'the-team'

	=> announces :
		'global_announce' => 'announces'

	=> Active topics :
		'atopic' => 'active-topics'

	=> Unaswered :
		'utopic' => 'unanswered'

	=> Newposts :
		'npost' => 'newposts'
 
	=> As well as forum ('forum' => 'forum'), topic ('topic' => 'topic'), post ('post' => 'post'), 
	member ('user' => 'member'), groups ('group' => 'group') and virtual folder pagination ('pagination' => 'page')

	=> And the suffixes, if you do not like .html :
		$this->seo_ext = array( 'forum' => '.html', 'topic' => '.html', 'post' => '.html', 'user' => '.html', 'group' => '.html',  'index' => '', 'global_announce' => '/', 'leaders' => '.html', 'atopic' => '.html', 'utopic' => '.html', 'npost' => '.html', 'pagination' => '.html', 'gz_ext' => '');

	Please note that suffixes may not be ".php" or empty, if you set a suffix to "/", 
	it will automatically activate the pagexx.html pagination.

Once set, these settings will be taken into account while generating the .htaccess.

=> Other options are configurable on the setting page (step 7 of the above list).
Go to the "phpBB SEO Class Settings" page, and take your time to set up the class as you wish.

=> It is now time to play with your forum URLs. 
To do so, go to the "Forum URL management" page and start selecting good keywords for your forum URLs.
Take your time to do it, and remember that using the remove IDs option in the settings makes it a bit harder to build appropriate redirection, in case you edit the forum URLs later.
If you later create more forums, you'll just have to go to this page again an eventually update the 
new forum URL.
If not, the new forum URL will not be cached and the default one will be used (forum-title-fxx).

___________
NOTE: Cache
___________
The cache files are in the phpbb_seo_/cache/ folder.
phpbb_cache.php is the cached file containing both your settings and forum URLs.

The mod always creates a backups of the current cached file : 
	=> phpbb_cache.php.current is a copy of the phpbb_cache.php file.
	It will automatically be used in case phpbb_cache.php is deleted or corrupted (which should not occur but).
	=> phpbb_cache.php.old is a copy of the previous settings you had set, before the last update you performed.

You should backup these file when you update them, they are as crucial as you data base for your forum
since they are required for your forum URL to work properly.
So relax, this is just a basic precaution, you should not have trouble with these, 
but never is better, hence the backup.

_________________
NOTE: .htaccess :
_________________

On the phpBB SEO ACP module, go to the ".htaccess" page.
A personalised .htaccess will be generated. It's the first one to consider trying.
If the default suggestion does not work, you will be to try more options, and generate several alternative.
You'll find an empty .htaccess file in this mod's archive contrib/ folder, you can use it to paste the .htaccess content generated on the htaccess page or save it directly on the server.


Please take a look at : http://www.phpbb-seo.com/boards/seo-principles/locking-the-www-in-urls-vt30.html
to find out how to lock the use (or non use) of the www prefix in your domain's url.
This is a major Search Engine Optimisation issue to take care of the www prefix issue.

__________________
NOTE: robots.txt :
__________________

You will find a sample robots.txt file in the contrib/ folder of this package.
The robots.txt file must be uploaded in your domain's root folder (can be different from the phpBB one).
You must obviously replace phpbb/ with your real phpBB installation folder (or with nothing if it's installed in the domain's root).

IMPORTANT :
	If your forum previously was indexed with the natural urls (viewtopic.php etc...), then you must make sure
	that the robots.txt advised for our mod rewrite is not installed, if so delete it from the server.
	This because we want to redirect old urls before we disallow them, it's crucial!
	In such case, a month or two after you activated the zero duplicate, you can safely implement the robots.txt.

__________________________________________________
NOTE: profile and user messages pages ID removing:
__________________________________________________

phpBB/member/nicknames VS  phpBB/nicknames-uxx.html

If you use profile and / or user messages pages ID removing, you should know that a custom urlencode 
will be used to circumvent a bug with mod_rewrite.
This imply that some chars like "&", "/", "#" and spaces will always be double encoded.
For example a user named rock&roll will require rock%2526roll (double urlencoded &) to be usable.
( http://www.php.net/urlencode => http://issues.apache.org/bugzilla/show_bug.cgi?id=34602 )

There are other issues with custom characters, like accents, which will add some urlencoded chars in urls.
It's not an SEO issue, since bots knows about urlencoding, but it can end up building pretty long url with multi byte characters.
This does not concern the a-zA-Z0-9 chars, underscore ("_"), hyphen ("-") and dot (".") included.
In phpbb_seo/phpbb_seo_class.php, you will no longer see different methods.

This of course means that the ID removing on profile and user messages pages is more comfy and universally efficient 
to use with alphanumeric chars user names (without accents). 

If you only allow alphanumeric chars for your user nicknames, then you can make the injection process faster by adding :

	return $url;

right after :

	function seo_url_encode( $url ) {

Remember that keeping the ID here will always work and that you still can simulate a folder structure for user messages pages.

_________________________
NOTE: GYM Sitemaps & RSS :
_________________________

The GYM sitemap & RSS module is now included in the phpBB SEO premod. 
This module will create United Sitemaps (Aka Google sitemaps), RSS 2.0 feeds, site maps and news pages for for phpBB3.
It fully supports Gun-zip cache for all types of outputs and some XSL-Transform styling for Sitemaps and RSS feeds. 
Please visit the relase thread for updates and further information : 
http://www.phpbb-seo.com/forums/gym-sitemaps-rss/sitemaps-rss-google-yahoo-msn-vt3136.html

PLEASE NOTE : 

	GYM Sitemaps & RSS is released at a RC stage, the install left separated from the regular install.
	It's up to you to use it or not, but you should know that at this stage, some feature may not be implemented and bugs
	may still be found.
	And, even more important, GYM sitemaps and RSS is likely to be updated before the premod, it will be up to you to
	keep it up to date meanwhile, you can be notified about updates by subscribing to the release thread while logged in :
	http://www.phpbb-seo.com/boards/viewtopic.php?t=2734&watch=topic


TO INSTALL THE MODULE :

If phpbb is installed in a sub folder and you run other pages at the root level, 
you can take advantage of this system's modularity to include all of your site's sitemaps in this same sitemapindex.

You'll have to put the sitemap.php file at the domain's root level, since no link from above 
the sitemap files folder are taken into consideration by Search Engines. 
To do this, you only need to open sitemap.php, and look for :

$phpbb_root_path = './';

and change it to : 

$phpbb_root_path = './phpbb/';

Obviously replacing phpbb/ with the real folder name where phpBB would be installed.
Then you would need to go ACP and update the "Google Sitemaps URL" paramter, in the Google sitemaps main panel, to match your
domain's root location instead of the phpBB url : http://www.example.com/ instead of http://www.example.com/phpbb/
Links to the forum will of course stay valid.
You can do the same with gymrss.php if you wish.

_____________
Please note :
_____________

If you run phpBB in a sub directory (example.com/phpbb/) and installed the sitemap (and / or gymrss.php) file at the root level
(example.com/sitemap.php) following the instructions above, you will need to change paths in the sitemap (and / or gymrss.php) 
rewriterules accordingly.
And if your phpBB's .htaccess was in the phpBB/ directory, to move them to the domain's root .htaccess.


===> To Install <===

	=> Connect yourself as admin and go to http://www.yourdomain.com/phpbb_folder/gym_sitemaps/gym_install.php to install

!!!!! The SQL involved in the install script where tested for all mysql versions, but unfrotunately 
not with the other possible DBAL (oracle, sqlite, postgresql etc ...), 
chances are great that it will work though !!!!!

GYM sitemaps & RSS should work with all DBAL supported by phpBB.

======> The only url to submit for all your sitemaps is http://www.yourdomain.com/phpbb/sitemap.php 
======> or http://www.yourdomain.com/phpbb/sitemapindex.xml with URL rewritting. 
======> You should make sure that the url is valid before you submit, just load the url in your browser to see the mod in action.



To uninstall :

	1) Connect yourself as admin and go to http://www.yourdomain.com/phpbb_folder/gym_sitemaps/gym_install.php to un-install

	2) remove all files and code changes added

________________
NOTE : .htaccess
________________

If the GYM Sitemaps & RSS module is installed, the .htaccess generator will automatically generate the required rewriterules 
for GYM sitemaps & RSS. Just generate a new .htaccess once you have installed the module and implement it.

#
#-----[ COPY ]--------------------------------------------------
#

copy root/*.* to root/*.*

#
#-----[ SAVE/CLOSE ALL FILES ]------------------------------------------
#
# EoM
